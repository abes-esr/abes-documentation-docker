version: "3.2"
services:
  documentation-web:
    build: .
    mem_limit: ${DOCUMENTATION_WEB_MEM_LIMIT:-5g}
    memswap_limit: ${DOCUMENTATION_WEB_MEMSWAP_LIMITi:-5g}
    cpus: ${DOCUMENTATION_WEB_CPU_LIMIT:-5}
    hostname: documentation-web
    container_name: documentation-web
    restart: unless-stopped
    ports:
      - 38080:80
    volumes:
      - ./volumes/documentation-web/var_www_html/:/usr/local/apache2/htdocs/
        # choose between var_www_html_index-dev.htm, var_www_html_index-test.htm and var_www_html_index-prod.htm with env variable in .env_dist (by default it's "dev")
        #- ./configs/documentation-web/var_www_html_index-${DOCUMENTATION_ENV:-dev}.html:/usr/local/apache2/htdocs/index.html
      - ./configs/documentation-web/abes_apache_conf/:/usr/local/apache2/conf/abes/
  documentation-gm-swish-e:
    image: abesesr/swish-e-docker:1.1.1
    mem_limit: ${DOCUMENTATION_GM_SWISHE_MEM_LIMIT:-5g}
    memswap_limit: ${DOCUMENTATION_GM_SWISHE_MEMSWAP_LIMITi:-5g}
    cpus: ${DOCUMENTATION_GM_SWISHE_CPU_LIMIT:-5}
    hostname: documentation-gm-swish-e
    container_name: documentation-gm-swish-e
    restart: unless-stopped
    ports:
      - 38081:80
    volumes:
      - ./volumes/documentation-web/var_www_html/guide/html/:/var/www/html/
      - ./configs/documentation-gm-swish-e/conf-swish-e/swish.cgi:/usr/lib/cgi-bin/swish.cgi
      - ./configs/documentation-gm-swish-e/conf-swish-e/TemplateDefault.pm:/usr/lib/swish-e/perl/SWISH/TemplateDefault.pm
        # choose between .swishcgi-dev.conf, .swishcgi-test.conf and .swishcgi-prod.conf with env variable in .env_dist (by default it's "dev")
      - ./configs/documentation-gm-swish-e/conf-swish-e/.swishcgi-${DOCUMENTATION_ENV:-dev}.conf:/usr/lib/cgi-bin/.swishcgi.conf
      - ./configs/documentation-gm-swish-e/index-swish-e/:/opt/guide/data-swish-e/
      - ./configs/documentation-gm-swish-e/scripts-swish-e/:/opt/guide/data-swish-e/scripts/
  documentation-webdav:
    image: bytemark/webdav:2.4
    mem_limit: ${DOCUMENTATION_WEBDAV_MEM_LIMIT:-5g}
    memswap_limit: ${DOCUMENTATION_WEBDAV_MEMSWAP_LIMITi:-5g}
    cpus: ${DOCUMENTATION_WEBDAV_CPU_LIMIT:-5}
    hostname: documentation-webdav
    container_name: documentation-webdav
    restart: unless-stopped
    ports:
      - "38082:80"
    environment:
      AUTH_TYPE: Digest
      USERNAME: ${DOCUMENTATION_WEBDAV_USERNAME}
      PASSWORD: ${DOCUMENTATION_WEBDAV_PASSWORD}
      LOCATION: /webdav
      REALM: ${REALM}
    volumes:
      - ./volumes/documentation-web/var_www_html/:/var/lib/dav/data/
      - ./configs/documentation-webdav/abes-dav.conf:/usr/local/apache2/conf/conf-available/dav.conf
      - ./configs/documentation-webdav/docker-entrypoint.sh:/usr/local/bin/docker-entrypoint.sh
  documentation-rp:
    hostname: documentation-rp
    container_name: documentation-rp
    restart: unless-stopped
    image: nginx:latest
    ports:
      - 38089:80
    volumes:
      - ./configs/documentation-rp/default.conf:/etc/nginx/conf.d/default.conf
      - ./configs/documentation-rp/nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - documentation-web
      - documentation-gm-swish-e
      - documentation-webdav
